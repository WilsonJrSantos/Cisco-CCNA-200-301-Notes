# 🧭 Día 5 - Introducción y Funcionamiento de OSPF

## 📘 1.1.1 Introducción a OSPF

El **Open Shortest Path First (OSPF)** es un protocolo de enrutamiento **de estado de enlace** desarrollado como alternativa a **RIP (Routing Information Protocol)**. Mientras que RIP se basa únicamente en el conteo de saltos, **OSPF utiliza un cálculo basado en el costo**, lo que permite una **mayor escalabilidad y convergencia más rápida** en redes complejas.

---

### 🌐 Versiones de OSPF

| Versión | Protocolo | Uso principal | Soporte IP |
|----------|------------|----------------|-------------|
| **OSPFv2** | RFC 2328 | Redes IPv4 | IPv4 |
| **OSPFv3** | RFC 5340 | Redes IPv6 | IPv6 |

> 💡 **Dato:** En este módulo nos enfocaremos en **OSPFv2 de área única** (Single Area OSPF).

---

### 🧩 Conceptos clave

- **Área OSPF:** agrupación lógica de routers que comparten la misma base de datos LSDB.
- **Estado de enlace:** información que describe un enlace o interfaz de red, su prefijo, longitud y costo.
- **Costo:** métrica utilizada por OSPF para determinar la mejor ruta hacia un destino.  
  Por defecto:
```

Costo = 100,000,000 / Ancho de banda (bps)

```

![Diagrama de área única OSPF](images/lab-dia5/ospf-area-unica.png)

---

## ⚙️ 1.1.2 Componentes de OSPF

Todos los protocolos de enrutamiento utilizan tres componentes esenciales: **mensajes**, **bases de datos** y **algoritmos**.

---

### 📡 Mensajes de protocolo OSPF

OSPF utiliza **cinco tipos de paquetes** para intercambiar información:

| Tipo | Nombre del paquete | Función principal |
|------|--------------------|------------------|
| 1 | Hello | Descubrir y mantener vecinos |
| 2 | DBD (Database Description) | Sincronizar bases de datos |
| 3 | LSR (Link-State Request) | Solicitar información faltante |
| 4 | LSU (Link-State Update) | Enviar información nueva |
| 5 | LSAck (Link-State Acknowledgment) | Confirmar recepción de LSAs |

![Tipos de paquetes OSPF](images/lab-dia5/ospf-paquetes.png)

---

### 🧠 Estructuras de datos OSPF

| Base de datos | Tabla resultante | Descripción | Comando de verificación |
|----------------|------------------|--------------|--------------------------|
| **Adyacencia** | Tabla de vecinos | Lista de routers vecinos con comunicación bidireccional. | `show ip ospf neighbor` |
| **Estado de enlace (LSDB)** | Tabla de topología | Información detallada de todos los routers y enlaces en el área. | `show ip ospf database` |
| **Reenvío** | Tabla de enrutamiento | Rutas óptimas calculadas por el algoritmo SPF. | `show ip route ospf` |

---

## 🔄 1.1.3 Funcionamiento del Estado de Enlace (Link-State Operation)

El proceso general de OSPF para alcanzar convergencia se divide en **cinco pasos principales**:

| Paso | Descripción | Imagen |
|------|--------------|--------|
| 1️⃣ | **Establecer adyacencias** con routers vecinos mediante paquetes *Hello*. | ![Adyacencias OSPF](images/lab-dia5/ospf-adyacencias.png) |
| 2️⃣ | **Intercambiar LSAs (Link-State Advertisements)** para compartir información de topología. | ![Intercambio de LSA](images/lab-dia5/ospf-lsa.png) |
| 3️⃣ | **Construir la base de datos LSDB** con la información recopilada. | ![Base de datos LSDB](images/lab-dia5/ospf-lsdb.png) |
| 4️⃣ | **Ejecutar el algoritmo SPF (Dijkstra)** para calcular el árbol de rutas más cortas. | ![Árbol SPF](images/lab-dia5/ospf-spf.png) |
| 5️⃣ | **Seleccionar las mejores rutas** y colocarlas en la tabla de enrutamiento. | ![Tabla de rutas OSPF](images/lab-dia5/ospf-routing-table.png) |

---

## 🏗️ 1.1.4 OSPF de Área Única y Multiárea

OSPF soporta **enrutamiento jerárquico**, lo que permite dividir la red en áreas más pequeñas y controladas.

| Tipo de implementación | Descripción | Características |
|------------------------|-------------|----------------|
| **Área única** | Todos los routers están dentro de un solo dominio OSPF (por lo general, área 0). | Ideal para redes pequeñas o medianas. |
| **Multiárea** | Divide la red en múltiples áreas conectadas al área troncal (área 0). | Escalable y eficiente en grandes redes. |

![Topología multiárea OSPF](images/lab-dia5/ospf-multiarea.png)

---

## 🧱 1.1.5 Ventajas de OSPF Multiárea

| Ventaja | Descripción |
|----------|-------------|
| **Tablas más pequeñas** | Se pueden resumir rutas entre áreas. |
| **Menor sobrecarga** | Las actualizaciones LSA se limitan dentro de cada área. |
| **Menor frecuencia de cálculo SPF** | Los cambios en una área no afectan otras. |

> 🔍 Ejemplo:  
> Si un cambio ocurre en el **Área 51**, solo los routers dentro de esa área recalculan el SPF. Los demás simplemente actualizan sus tablas.

![Aislamiento de fallas OSPF Multiárea](images/lab-dia5/ospf-aislamiento.png)

---

## 🌐 1.1.6 OSPFv3 (para IPv6)

OSPFv3 es la versión moderna de OSPF, diseñada para funcionar sobre **IPv6**.  
Tiene prácticamente la misma funcionalidad que OSPFv2, pero con cambios en transporte y estructura.

| Comparativa | **OSPFv2** | **OSPFv3** |
|--------------|-------------|-------------|
| Capa de red | IPv4 | IPv6 |
| Tipo de direcciones | IPv4 (32 bits) | IPv6 (128 bits) |
| Identificación de router | Router-ID (IPv4) | Router-ID independiente del prefijo IPv6 |
| Tablas | Vecinos, LSDB, rutas IPv4 | Vecinos, LSDB, rutas IPv6 |

![Comparativa OSPFv2 vs OSPFv3](images/lab-dia5/ospfv2-vs-ospfv3.png)

---

## 📦 1.2.2 Tipos de Paquetes OSPF

| Tipo | Nombre | Descripción | Ejemplo |
|------|---------|--------------|----------|
| **1** | Hello | Descubre vecinos y construye adyacencias. | Detecta routers vecinos activos. |
| **2** | DBD | Sincroniza LSDB entre routers. | Intercambia encabezados de LSA. |
| **3** | LSR | Solicita registros específicos. | Pide detalles faltantes. |
| **4** | LSU | Envía actualizaciones de estado de enlace. | Distribuye nuevos LSAs. |
| **5** | LSAck | Confirma recepción de LSAs. | Evita retransmisiones innecesarias. |

![Estructura de paquetes OSPF](images/lab-dia5/ospf-paquetes-hello.png)

---

## 💬 1.2.4 Paquete Hello (Tipo 1)

El **paquete Hello** es el más importante, ya que permite descubrir y mantener la relación entre routers OSPF.

### Contenido principal:

```

+----------------------------------------------------+
| Router ID | ID de Área | Tipo = 1 (Hello)         |
+----------------------------------------------------+
| Máscara de red | Intervalo Hello | Prioridad DR   |
+----------------------------------------------------+
| DR | BDR | Lista de Vecinos                        |
+----------------------------------------------------+

````

![Diagrama del paquete Hello OSPFv2](images/lab-dia5/ospf-paquete-hello.png)

> 📡 Dirección multicast utilizada: **224.0.0.5**

---

## 🔁 1.3.2 Estados de Funcionamiento de OSPF

Cuando OSPF intenta lograr la convergencia, pasa por varios **estados de vecino**:

| Estado | Descripción |
|---------|-------------|
| **Down** | No se reciben paquetes Hello. |
| **Init** | Se envían paquetes Hello, pero aún no hay respuesta. |
| **Two-Way** | Comunicación bidireccional establecida. |
| **ExStart** | Elección de quién envía primero los DBD. |
| **Exchange** | Intercambio de descripciones de base de datos. |
| **Loading** | Solicitud y recepción de LSAs faltantes. |
| **Full** | Sincronización completa y estable. |

![Estados de vecino OSPF](images/lab-dia5/ospf-estados-vecino.png)

---

## 🤝 1.3.3 Establecimiento de Adyacencias

Ejemplo del proceso entre R1 y R2:

1. **Down → Init:**  
   R1 envía paquete Hello → `224.0.0.5`
2. **Init → Two-Way:**  
   R2 responde y ambos reconocen sus IDs.
3. **Elección DR/BDR:**  
   En redes Ethernet, el router con mayor *Router ID* será el **DR**.
4. **Exchange → Loading → Full:**  
   Intercambio de DBD, LSR, LSU y LSAck hasta sincronizar LSDB.

![Elección de DR y BDR](images/lab-dia5/ospf-dr-bdr.png)

---

## 🧮 1.3.5 Necesidad de un DR (Designated Router)

En redes **multiacceso (LAN Ethernet)**, sin un DR habría demasiadas adyacencias:

> Fórmula:  
> `n(n - 1) / 2`

| Número de routers (n) | Adyacencias |
|------------------------|--------------|
| 5 | 10 |
| 10 | 45 |
| 20 | 190 |

![Adyacencias múltiples OSPF](images/lab-dia5/ospf-adyacencias-multiples.png)

> 🔧 El DR y BDR **reducen drásticamente la cantidad de tráfico LSA**.

---

## 🌊 1.3.6 Inundación de LSA con DR/BDR

En una red multiacceso:
- El **DR** actúa como colector y distribuidor de LSAs.
- El **BDR** actúa como respaldo.
- Los demás routers son **DROTHER**.

![Rol del DR en OSPF](images/lab-dia5/ospf-dr-lsa.png)

> 💬 El DR no enruta tráfico de usuario, solo gestiona la distribución de LSAs.

---

## 📚 Conclusión

OSPF es un **protocolo de enrutamiento dinámico avanzado** que:
- Proporciona **convergencia rápida**.
- Escala mediante **enrutamiento jerárquico**.
- Utiliza **paquetes estructurados y eficientes**.
- Aplica el **algoritmo SPF de Dijkstra** para encontrar las mejores rutas.

---

> 🧠 **Comando útil para practicar en Cisco IOS:**
```bash
R1(config)# router ospf 1
R1(config-router)# network 192.168.10.0 0.0.0.255 area 0
R1# show ip ospf neighbor
R1# show ip route ospf
````

---

![Fin del módulo OSPF](images/lab-dia5/ospf-fin.png)

```
```
