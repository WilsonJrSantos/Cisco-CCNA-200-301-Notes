# ðŸ§­ DÃ­a 5 - IntroducciÃ³n y Funcionamiento de OSPF

## ðŸ“˜ 1.1.1 IntroducciÃ³n a OSPF

El **Open Shortest Path First (OSPF)** es un protocolo de enrutamiento **de estado de enlace** desarrollado como alternativa a **RIP (Routing Information Protocol)**. Mientras que RIP se basa Ãºnicamente en el conteo de saltos, **OSPF utiliza un cÃ¡lculo basado en el costo**, lo que permite una **mayor escalabilidad y convergencia mÃ¡s rÃ¡pida** en redes complejas.

---

### ðŸŒ Versiones de OSPF

| VersiÃ³n | Protocolo | Uso principal | Soporte IP |
|----------|------------|----------------|-------------|
| **OSPFv2** | RFC 2328 | Redes IPv4 | IPv4 |
| **OSPFv3** | RFC 5340 | Redes IPv6 | IPv6 |

> ðŸ’¡ **Dato:** En este mÃ³dulo nos enfocaremos en **OSPFv2 de Ã¡rea Ãºnica** (Single Area OSPF).

---

### ðŸ§© Conceptos clave

- **Ãrea OSPF:** agrupaciÃ³n lÃ³gica de routers que comparten la misma base de datos LSDB.
- **Estado de enlace:** informaciÃ³n que describe un enlace o interfaz de red, su prefijo, longitud y costo.
- **Costo:** mÃ©trica utilizada por OSPF para determinar la mejor ruta hacia un destino.  
  Por defecto:
```

Costo = 100,000,000 / Ancho de banda (bps)

```

![Diagrama de Ã¡rea Ãºnica OSPF](images/lab-dia5/ospf-area-unica.png)

---

## âš™ï¸ 1.1.2 Componentes de OSPF

Todos los protocolos de enrutamiento utilizan tres componentes esenciales: **mensajes**, **bases de datos** y **algoritmos**.

---

### ðŸ“¡ Mensajes de protocolo OSPF

OSPF utiliza **cinco tipos de paquetes** para intercambiar informaciÃ³n:

| Tipo | Nombre del paquete | FunciÃ³n principal |
|------|--------------------|------------------|
| 1 | Hello | Descubrir y mantener vecinos |
| 2 | DBD (Database Description) | Sincronizar bases de datos |
| 3 | LSR (Link-State Request) | Solicitar informaciÃ³n faltante |
| 4 | LSU (Link-State Update) | Enviar informaciÃ³n nueva |
| 5 | LSAck (Link-State Acknowledgment) | Confirmar recepciÃ³n de LSAs |

![Tipos de paquetes OSPF](images/lab-dia5/ospf-paquetes.png)

---

### ðŸ§  Estructuras de datos OSPF

| Base de datos | Tabla resultante | DescripciÃ³n | Comando de verificaciÃ³n |
|----------------|------------------|--------------|--------------------------|
| **Adyacencia** | Tabla de vecinos | Lista de routers vecinos con comunicaciÃ³n bidireccional. | `show ip ospf neighbor` |
| **Estado de enlace (LSDB)** | Tabla de topologÃ­a | InformaciÃ³n detallada de todos los routers y enlaces en el Ã¡rea. | `show ip ospf database` |
| **ReenvÃ­o** | Tabla de enrutamiento | Rutas Ã³ptimas calculadas por el algoritmo SPF. | `show ip route ospf` |

---

## ðŸ”„ 1.1.3 Funcionamiento del Estado de Enlace (Link-State Operation)

El proceso general de OSPF para alcanzar convergencia se divide en **cinco pasos principales**:

| Paso | DescripciÃ³n | Imagen |
|------|--------------|--------|
| 1ï¸âƒ£ | **Establecer adyacencias** con routers vecinos mediante paquetes *Hello*. | ![Adyacencias OSPF](images/lab-dia5/ospf-adyacencias.png) |
| 2ï¸âƒ£ | **Intercambiar LSAs (Link-State Advertisements)** para compartir informaciÃ³n de topologÃ­a. | ![Intercambio de LSA](images/lab-dia5/ospf-lsa.png) |
| 3ï¸âƒ£ | **Construir la base de datos LSDB** con la informaciÃ³n recopilada. | ![Base de datos LSDB](images/lab-dia5/ospf-lsdb.png) |
| 4ï¸âƒ£ | **Ejecutar el algoritmo SPF (Dijkstra)** para calcular el Ã¡rbol de rutas mÃ¡s cortas. | ![Ãrbol SPF](images/lab-dia5/ospf-spf.png) |
| 5ï¸âƒ£ | **Seleccionar las mejores rutas** y colocarlas en la tabla de enrutamiento. | ![Tabla de rutas OSPF](images/lab-dia5/ospf-routing-table.png) |

---

## ðŸ—ï¸ 1.1.4 OSPF de Ãrea Ãšnica y MultiÃ¡rea

OSPF soporta **enrutamiento jerÃ¡rquico**, lo que permite dividir la red en Ã¡reas mÃ¡s pequeÃ±as y controladas.

| Tipo de implementaciÃ³n | DescripciÃ³n | CaracterÃ­sticas |
|------------------------|-------------|----------------|
| **Ãrea Ãºnica** | Todos los routers estÃ¡n dentro de un solo dominio OSPF (por lo general, Ã¡rea 0). | Ideal para redes pequeÃ±as o medianas. |
| **MultiÃ¡rea** | Divide la red en mÃºltiples Ã¡reas conectadas al Ã¡rea troncal (Ã¡rea 0). | Escalable y eficiente en grandes redes. |

![TopologÃ­a multiÃ¡rea OSPF](images/lab-dia5/ospf-multiarea.png)

---

## ðŸ§± 1.1.5 Ventajas de OSPF MultiÃ¡rea

| Ventaja | DescripciÃ³n |
|----------|-------------|
| **Tablas mÃ¡s pequeÃ±as** | Se pueden resumir rutas entre Ã¡reas. |
| **Menor sobrecarga** | Las actualizaciones LSA se limitan dentro de cada Ã¡rea. |
| **Menor frecuencia de cÃ¡lculo SPF** | Los cambios en una Ã¡rea no afectan otras. |

> ðŸ” Ejemplo:  
> Si un cambio ocurre en el **Ãrea 51**, solo los routers dentro de esa Ã¡rea recalculan el SPF. Los demÃ¡s simplemente actualizan sus tablas.

![Aislamiento de fallas OSPF MultiÃ¡rea](images/lab-dia5/ospf-aislamiento.png)

---

## ðŸŒ 1.1.6 OSPFv3 (para IPv6)

OSPFv3 es la versiÃ³n moderna de OSPF, diseÃ±ada para funcionar sobre **IPv6**.  
Tiene prÃ¡cticamente la misma funcionalidad que OSPFv2, pero con cambios en transporte y estructura.

| Comparativa | **OSPFv2** | **OSPFv3** |
|--------------|-------------|-------------|
| Capa de red | IPv4 | IPv6 |
| Tipo de direcciones | IPv4 (32 bits) | IPv6 (128 bits) |
| IdentificaciÃ³n de router | Router-ID (IPv4) | Router-ID independiente del prefijo IPv6 |
| Tablas | Vecinos, LSDB, rutas IPv4 | Vecinos, LSDB, rutas IPv6 |

![Comparativa OSPFv2 vs OSPFv3](images/lab-dia5/ospfv2-vs-ospfv3.png)

---

## ðŸ“¦ 1.2.2 Tipos de Paquetes OSPF

| Tipo | Nombre | DescripciÃ³n | Ejemplo |
|------|---------|--------------|----------|
| **1** | Hello | Descubre vecinos y construye adyacencias. | Detecta routers vecinos activos. |
| **2** | DBD | Sincroniza LSDB entre routers. | Intercambia encabezados de LSA. |
| **3** | LSR | Solicita registros especÃ­ficos. | Pide detalles faltantes. |
| **4** | LSU | EnvÃ­a actualizaciones de estado de enlace. | Distribuye nuevos LSAs. |
| **5** | LSAck | Confirma recepciÃ³n de LSAs. | Evita retransmisiones innecesarias. |

![Estructura de paquetes OSPF](images/lab-dia5/ospf-paquetes-hello.png)

---

## ðŸ’¬ 1.2.4 Paquete Hello (Tipo 1)

El **paquete Hello** es el mÃ¡s importante, ya que permite descubrir y mantener la relaciÃ³n entre routers OSPF.

### Contenido principal:

```

+----------------------------------------------------+
| Router ID | ID de Ãrea | Tipo = 1 (Hello)         |
+----------------------------------------------------+
| MÃ¡scara de red | Intervalo Hello | Prioridad DR   |
+----------------------------------------------------+
| DR | BDR | Lista de Vecinos                        |
+----------------------------------------------------+

````

![Diagrama del paquete Hello OSPFv2](images/lab-dia5/ospf-paquete-hello.png)

> ðŸ“¡ DirecciÃ³n multicast utilizada: **224.0.0.5**

---

## ðŸ” 1.3.2 Estados de Funcionamiento de OSPF

Cuando OSPF intenta lograr la convergencia, pasa por varios **estados de vecino**:

| Estado | DescripciÃ³n |
|---------|-------------|
| **Down** | No se reciben paquetes Hello. |
| **Init** | Se envÃ­an paquetes Hello, pero aÃºn no hay respuesta. |
| **Two-Way** | ComunicaciÃ³n bidireccional establecida. |
| **ExStart** | ElecciÃ³n de quiÃ©n envÃ­a primero los DBD. |
| **Exchange** | Intercambio de descripciones de base de datos. |
| **Loading** | Solicitud y recepciÃ³n de LSAs faltantes. |
| **Full** | SincronizaciÃ³n completa y estable. |

![Estados de vecino OSPF](images/lab-dia5/ospf-estados-vecino.png)

---

## ðŸ¤ 1.3.3 Establecimiento de Adyacencias

Ejemplo del proceso entre R1 y R2:

1. **Down â†’ Init:**  
   R1 envÃ­a paquete Hello â†’ `224.0.0.5`
2. **Init â†’ Two-Way:**  
   R2 responde y ambos reconocen sus IDs.
3. **ElecciÃ³n DR/BDR:**  
   En redes Ethernet, el router con mayor *Router ID* serÃ¡ el **DR**.
4. **Exchange â†’ Loading â†’ Full:**  
   Intercambio de DBD, LSR, LSU y LSAck hasta sincronizar LSDB.

![ElecciÃ³n de DR y BDR](images/lab-dia5/ospf-dr-bdr.png)

---

## ðŸ§® 1.3.5 Necesidad de un DR (Designated Router)

En redes **multiacceso (LAN Ethernet)**, sin un DR habrÃ­a demasiadas adyacencias:

> FÃ³rmula:  
> `n(n - 1) / 2`

| NÃºmero de routers (n) | Adyacencias |
|------------------------|--------------|
| 5 | 10 |
| 10 | 45 |
| 20 | 190 |

![Adyacencias mÃºltiples OSPF](images/lab-dia5/ospf-adyacencias-multiples.png)

> ðŸ”§ El DR y BDR **reducen drÃ¡sticamente la cantidad de trÃ¡fico LSA**.

---

## ðŸŒŠ 1.3.6 InundaciÃ³n de LSA con DR/BDR

En una red multiacceso:
- El **DR** actÃºa como colector y distribuidor de LSAs.
- El **BDR** actÃºa como respaldo.
- Los demÃ¡s routers son **DROTHER**.

![Rol del DR en OSPF](images/lab-dia5/ospf-dr-lsa.png)

> ðŸ’¬ El DR no enruta trÃ¡fico de usuario, solo gestiona la distribuciÃ³n de LSAs.

---

## ðŸ“š ConclusiÃ³n

OSPF es un **protocolo de enrutamiento dinÃ¡mico avanzado** que:
- Proporciona **convergencia rÃ¡pida**.
- Escala mediante **enrutamiento jerÃ¡rquico**.
- Utiliza **paquetes estructurados y eficientes**.
- Aplica el **algoritmo SPF de Dijkstra** para encontrar las mejores rutas.

---

> ðŸ§  **Comando Ãºtil para practicar en Cisco IOS:**
```bash
R1(config)# router ospf 1
R1(config-router)# network 192.168.10.0 0.0.0.255 area 0
R1# show ip ospf neighbor
R1# show ip route ospf
````

---

![Fin del mÃ³dulo OSPF](images/lab-dia5/ospf-fin.png)

```
```
